import{B as p}from"./chunk-NODSVL4F.js";import{Dc as g,S as a,X as l,_b as r,ka as u,n}from"./chunk-TOSGPUWZ.js";import{d as o}from"./chunk-4CLCTAJ7.js";var d=class i{http=l(g);base=p.apiBase;_user=u(null);user=r(()=>this._user());isLoggedIn=r(()=>!!this._user());isAdmin=r(()=>this._user()?.role==="admin");isVisitor=r(()=>this._user()?.role==="visitor");constructor(){let e=localStorage.getItem("auth");if(e){let{token:t,user:s}=JSON.parse(e);!t||this.isJwtExpired(t)?this.logout():this._user.set(s)}}login(e,t){return this.http.post(`${this.base}/auth/login`,{email:e,password:t})}validateUser(e,t){return o(this,null,function*(){return(yield n(this.login(e,t))).user})}saveSession(e,t){localStorage.setItem("auth",JSON.stringify({token:e,user:t})),this._user.set(t)}logout(){localStorage.removeItem("auth"),this._user.set(null),window.location.href="/"}getToken(){let e=localStorage.getItem("auth");return e?JSON.parse(e).token:null}isJwtExpired(e){try{let s=JSON.parse(atob(e.split(".")[1])).exp*1e3;return Date.now()>s}catch{return!0}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{d as a};
