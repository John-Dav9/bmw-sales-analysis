<mat-card>
  <mat-card-title>Explore</mat-card-title>
  <mat-card-content>
    <form class="filters" (ngSubmit)="fetch()">
      <mat-form-field>
        <mat-label>Year</mat-label>
        <input matInput type="number" [(ngModel)]="year" name="year" />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Region</mat-label>
        <input matInput [(ngModel)]="region" name="region" />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Model</mat-label>
        <input matInput [(ngModel)]="model" name="model" />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Color</mat-label>
        <input matInput [(ngModel)]="color" name="color" />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Fuel Type</mat-label>
        <input matInput [(ngModel)]="fuelType" name="fuelType" />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Transmission</mat-label>
        <input matInput [(ngModel)]="transmission" name="transmission" />
      </mat-form-field>
      <button mat-raised-button color="primary" type="submit">Filtrer</button>
      <button mat-button type="button" (click)="resetFilters()">Reset</button>
    </form>

    @if (!loading) {
      <div class="table-wrap">
        <table mat-table [dataSource]="data" class="mat-elevation-z1">
          <ng-container matColumnDef="year"><th mat-header-cell *matHeaderCellDef>Year</th><td mat-cell *matCellDef="let r">{{r.year}}</td></ng-container>
          <ng-container matColumnDef="make"><th mat-header-cell *matHeaderCellDef>Make</th><td mat-cell *matCellDef="let r">{{r.make}}</td></ng-container>
          <ng-container matColumnDef="model"><th mat-header-cell *matHeaderCellDef>Model</th><td mat-cell *matCellDef="let r">{{r.model}}</td></ng-container>
          <ng-container matColumnDef="region"><th mat-header-cell *matHeaderCellDef>Region</th><td mat-cell *matCellDef="let r">{{r.region}}</td></ng-container>
          <ng-container matColumnDef="color"><th mat-header-cell *matHeaderCellDef>Color</th><td mat-cell *matCellDef="let r">{{r.color}}</td></ng-container>
          <ng-container matColumnDef="price_usd"><th mat-header-cell *matHeaderCellDef>Price USD</th><td mat-cell *matCellDef="let r">{{ r.price_usd != null ? (+r.price_usd).toLocaleString('en-GB', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) : '' }}</td></ng-container>
          <ng-container matColumnDef="sales_volume"><th mat-header-cell *matHeaderCellDef>Units</th><td mat-cell *matCellDef="let r">{{r.sales_volume}}</td></ng-container>
          <ng-container matColumnDef="fuel_type"><th mat-header-cell *matHeaderCellDef>Fuel</th><td mat-cell *matCellDef="let r">{{r.fuel_type}}</td></ng-container>
          <ng-container matColumnDef="transmission"><th mat-header-cell *matHeaderCellDef>Trans.</th><td mat-cell *matCellDef="let r">{{r.transmission}}</td></ng-container>
          <ng-container matColumnDef="engine_size_l"><th mat-header-cell *matHeaderCellDef>Engine (L)</th><td mat-cell *matCellDef="let r">{{r.engine_size_l}}</td></ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <div class="pager">
          <button mat-stroked-button (click)="onPaginate('prev')" [disabled]="offset===0">Précédent</button>
          <span> {{offset + 1}}–{{offset + data.length}} / {{total}} </span>
          <button mat-stroked-button (click)="onPaginate('next')" [disabled]="offset + limit >= total">Suivant</button>
        </div>
      </div>
    } @else {
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    }
  </mat-card-content>
</mat-card>
